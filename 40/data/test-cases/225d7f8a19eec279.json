{"uid":"225d7f8a19eec279","name":"test_3_production_flow_with_real_data","fullName":"tests.test_api.TestAstroEngineAPI#test_3_production_flow_with_real_data","historyId":"f3d1f1231a6608759597da93e4948751","time":{"start":1768833948937,"stop":1768833949028,"duration":91},"description":"FULL INTEGRATION (Testing  service orchestrator).","descriptionHtml":"<p>FULL INTEGRATION (Testing  service orchestrator).</p>\n","status":"broken","statusMessage":"RuntimeError: Event loop is closed","statusTrace":"self = <tests.test_api.TestAstroEngineAPI object at 0x7ff3677aa910>\napi_client = <httpx.AsyncClient object at 0x7ff3594b26d0>\n\n    @allure.story(\"Production external endpoit\")\n    @allure.description(\"FULL INTEGRATION (Testing  service orchestrator).\")\n    \n    async def test_3_production_flow_with_real_data(self, api_client):\n        \"\"\"TEST 3: FULL INTEGRATION (Testing API JOYTISH server and AI Consultation).\"\"\"\n    \n        with allure.step(f\"Calling My Service: {INTERPRETATION_URL}\"):\n>           response = await api_client.post(INTERPRETATION_URL, json=payload_ai)\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntests/test_api.py:317: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection_pool.py:229: in handle_async_request\n    await self._close_connections(closing)\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection_pool.py:345: in _close_connections\n    await connection.aclose()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection.py:173: in aclose\n    await self._connection.aclose()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/http11.py:258: in aclose\n    await self._network_stream.aclose()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_backends/anyio.py:53: in aclose\n    await self._stream.aclose()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/anyio/streams/tls.py:241: in aclose\n    await self.transport_stream.aclose()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/anyio/_backends/_asyncio.py:1352: in aclose\n    self._transport.close()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/asyncio/selector_events.py:864: in close\n    self._loop.call_soon(self._call_connection_lost, None)\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/asyncio/base_events.py:762: in call_soon\n    self._check_closed()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <_UnixSelectorEventLoop running=False closed=True debug=False>\n\n    def _check_closed(self):\n        if self._closed:\n>           raise RuntimeError('Event loop is closed')\nE           RuntimeError: Event loop is closed\n\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/asyncio/base_events.py:520: RuntimeError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop_policy","time":{"start":1768833921805,"stop":1768833921805,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_client","time":{"start":1768833937226,"stop":1768833937249,"duration":23},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_function_scoped_runner","time":{"start":1768833948936,"stop":1768833948937,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"FULL INTEGRATION (Testing  service orchestrator).","status":"broken","statusMessage":"RuntimeError: Event loop is closed","statusTrace":"self = <tests.test_api.TestAstroEngineAPI object at 0x7ff3677aa910>\napi_client = <httpx.AsyncClient object at 0x7ff3594b26d0>\n\n    @allure.story(\"Production external endpoit\")\n    @allure.description(\"FULL INTEGRATION (Testing  service orchestrator).\")\n    \n    async def test_3_production_flow_with_real_data(self, api_client):\n        \"\"\"TEST 3: FULL INTEGRATION (Testing API JOYTISH server and AI Consultation).\"\"\"\n    \n        with allure.step(f\"Calling My Service: {INTERPRETATION_URL}\"):\n>           response = await api_client.post(INTERPRETATION_URL, json=payload_ai)\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntests/test_api.py:317: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1859: in post\n    return await self.request(\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1540: in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1629: in send\n    response = await self._send_handling_auth(\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1657: in _send_handling_auth\n    response = await self._send_handling_redirects(\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1694: in _send_handling_redirects\n    response = await self._send_single_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py:1730: in _send_single_request\n    response = await transport.handle_async_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_transports/default.py:394: in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection_pool.py:256: in handle_async_request\n    raise exc from None\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection_pool.py:229: in handle_async_request\n    await self._close_connections(closing)\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection_pool.py:345: in _close_connections\n    await connection.aclose()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection.py:173: in aclose\n    await self._connection.aclose()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/http11.py:258: in aclose\n    await self._network_stream.aclose()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_backends/anyio.py:53: in aclose\n    await self._stream.aclose()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/anyio/streams/tls.py:241: in aclose\n    await self.transport_stream.aclose()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/anyio/_backends/_asyncio.py:1352: in aclose\n    self._transport.close()\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/asyncio/selector_events.py:864: in close\n    self._loop.call_soon(self._call_connection_lost, None)\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/asyncio/base_events.py:762: in call_soon\n    self._check_closed()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <_UnixSelectorEventLoop running=False closed=True debug=False>\n\n    def _check_closed(self):\n        if self._closed:\n>           raise RuntimeError('Event loop is closed')\nE           RuntimeError: Event loop is closed\n\n/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/asyncio/base_events.py:520: RuntimeError","steps":[{"name":"Calling My Service: http://127.0.0.1:8000/api/v1/forecast/generate","time":{"start":1768833948937,"stop":1768833948938,"duration":1},"status":"broken","statusMessage":"RuntimeError: Event loop is closed\n","statusTrace":"  File \"/home/runner/work/joytishai/joytishai/tests/test_api.py\", line 317, in test_3_production_flow_with_real_data\n    response = await api_client.post(INTERPRETATION_URL, json=payload_ai)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py\", line 1859, in post\n    return await self.request(\n           ^^^^^^^^^^^^^^^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py\", line 1540, in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py\", line 1629, in send\n    response = await self._send_handling_auth(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py\", line 1657, in _send_handling_auth\n    response = await self._send_handling_redirects(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py\", line 1694, in _send_handling_redirects\n    response = await self._send_single_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_client.py\", line 1730, in _send_single_request\n    response = await transport.handle_async_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpx/_transports/default.py\", line 394, in handle_async_request\n    resp = await self._pool.handle_async_request(req)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection_pool.py\", line 256, in handle_async_request\n    raise exc from None\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection_pool.py\", line 229, in handle_async_request\n    await self._close_connections(closing)\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection_pool.py\", line 345, in _close_connections\n    await connection.aclose()\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/connection.py\", line 173, in aclose\n    await self._connection.aclose()\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_async/http11.py\", line 258, in aclose\n    await self._network_stream.aclose()\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/httpcore/_backends/anyio.py\", line 53, in aclose\n    await self._stream.aclose()\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/anyio/streams/tls.py\", line 241, in aclose\n    await self.transport_stream.aclose()\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 1352, in aclose\n    self._transport.close()\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/asyncio/selector_events.py\", line 864, in close\n    self._loop.call_soon(self._call_connection_lost, None)\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/asyncio/base_events.py\", line 762, in call_soon\n    self._check_closed()\n  File \"/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/asyncio/base_events.py\", line 520, in _check_closed\n    raise RuntimeError('Event loop is closed')\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":1,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"_function_scoped_runner::0","time":{"start":1768833949415,"stop":1768833949416,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_client::finalizer","time":{"start":1768833950638,"stop":1768833950638,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"feature","value":"API"},{"name":"story","value":"Production external endpoit"},{"name":"tag","value":"asyncio"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_api"},{"name":"subSuite","value":"TestAstroEngineAPI"},{"name":"host","value":"runnervmmtnos"},{"name":"thread","value":"2908-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_api"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":["asyncio"]},"source":"225d7f8a19eec279.json","parameterValues":[]}